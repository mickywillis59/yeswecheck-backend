<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>API Tester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-elevated: #0b1020;
      --bg-soft: #111827;
      --primary: #6366f1;
      --primary-soft: rgba(99,102,241,0.15);
      --accent: #22c55e;
      --border: #1f2937;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --radius-lg: 14px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 45px rgba(15,23,42,0.7);
      --shadow-chip: 0 8px 20px rgba(15,23,42,0.7);
      --transition-fast: 150ms ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 32px 16px;
    }

    .app-shell {
      width: 100%;
      max-width: 1160px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 20px;
      align-items: stretch;
    }

    @media (max-width: 960px) {
      .app-shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.88));
      border-radius: 22px;
      border: 1px solid rgba(148,163,184,0.12);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 16px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -120px;
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,0.08), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(129,140,248,0.08), transparent 60%);
      opacity: 0.7;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .panel-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .panel-title-chip {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: conic-gradient(from 160deg, #22c55e, #22c55e, #4ade80, #a7f3d0, #22c55e);
      box-shadow: 0 0 10px rgba(34,197,94,0.85);
    }

    .panel-subtitle {
      font-size: 11px;
      color: var(--text-muted);
      opacity: 0.9;
    }

    /* Request header */
    .badge-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      gap: 8px;
    }

    .badge-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.28);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(15,23,42,0.6));
      box-shadow: var(--shadow-chip);
    }

    .badge-pill {
      background: radial-gradient(circle at 0 0, rgba(96,165,250,0.28), rgba(15,23,42,1));
      border-color: rgba(129,140,248,0.55);
      color: #e5e7eb;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: linear-gradient(135deg, #60a5fa, #a855f7);
      box-shadow: 0 0 10px rgba(96,165,250,0.8);
    }

    .badge-pill.badge-green {
      background: radial-gradient(circle at 0 0, rgba(34,197,94,0.32), rgba(15,23,42,1));
      border-color: rgba(52,211,153,0.7);
      color: #bbf7d0;
    }

    /* Form */
    .field-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }

    .label {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .method-select {
      display: flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at 0 0, rgba(52,211,153,0.08), rgba(15,23,42,0.95));
      border-radius: 999px;
      padding: 4px 5px;
      border: 1px solid rgba(52,211,153,0.5);
      box-shadow: var(--shadow-chip);
      font-size: 11px;
    }

    .method-pill {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,0.9);
      background: rgba(15,23,42,0.8);
      color: var(--text-muted);
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast), border-color var(--transition-fast);
    }

    .method-pill.active {
      background: radial-gradient(circle at 0 0, rgba(52,211,153,0.8), #065f46);
      color: #ecfdf5;
      border-color: rgba(110,231,183,0.9);
      transform: translateY(-0.5px);
      box-shadow: 0 0 14px rgba(16,185,129,0.8);
    }

    .hotkey {
      font-size: 10px;
      padding: 1px 5px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      color: rgba(209,213,219,0.9);
      background: rgba(15,23,42,0.9);
    }

    .input {
      width: 100%;
      border-radius: 999px;
      padding: 8px 12px;
      border: 1px solid rgba(55,65,81,0.9);
      background: radial-gradient(circle at 0 0, rgba(15,23,42,0.9), #020617);
      color: var(--text-main);
      font-size: 13px;
      outline: none;
      transition: border-color 120ms ease-out, box-shadow 120ms ease-out, background 120ms ease-out;
    }

    .input::placeholder {
      color: rgba(148,163,184,0.7);
    }

    .input:focus {
      border-color: rgba(129,140,248,0.8);
      box-shadow: 0 0 0 1px rgba(129,140,248,0.5);
      background: radial-gradient(circle at 0 0, rgba(79,70,229,0.16), #020617);
    }

    .input-sm {
      border-radius: 10px;
      padding: 6px 9px;
      font-size: 12px;
    }

    .textarea {
      width: 100%;
      border-radius: 14px;
      padding: 9px 11px;
      border: 1px solid rgba(55,65,81,0.9);
      background: radial-gradient(circle at 0 0, rgba(15,23,42,0.9), #020617);
      color: var(--text-main);
      font-size: 12px;
      resize: vertical;
      min-height: 120px;
      outline: none;
      font-family: ui-monospace, Menlo, Monaco, Consolas, "SF Mono", monospace;
    }

    .textarea::placeholder {
      color: rgba(148,163,184,0.7);
    }

    .textarea:focus {
      border-color: rgba(129,140,248,0.8);
      box-shadow: 0 0 0 1px rgba(129,140,248,0.55);
      background: radial-gradient(circle at 0 0, rgba(79,70,229,0.16), #020617);
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .row-wrap {
      flex-wrap: wrap;
    }

    .row-space {
      justify-content: space-between;
    }

    .meta-chip {
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(75,85,99,0.9);
      color: var(--text-muted);
      background: rgba(15,23,42,0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .meta-chip strong {
      font-weight: 500;
      color: #e5e7eb;
    }

    .divider {
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(55,65,81,0.9), transparent);
      margin: 14px 0 8px;
    }

    /* Buttons */
    .primary-btn {
      border-radius: 999px;
      border: none;
      padding: 7px 18px;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: #0b1120;
      background: linear-gradient(135deg, #a855f7, #6366f1, #22c55e);
      box-shadow:
        0 0 0 1px rgba(191,219,254,0.2),
        0 18px 35px rgba(88,28,135,0.5);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }

    .primary-btn span {
      position: relative;
      z-index: 1;
    }

    .primary-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.4), transparent 60%);
      opacity: 0;
      transition: opacity 120ms ease-out;
    }

    .primary-btn:hover::before {
      opacity: 1;
    }

    .primary-btn:active {
      transform: translateY(1px);
      box-shadow:
        0 0 0 1px rgba(191,219,254,0.2),
        0 11px 18px rgba(15,23,42,0.9);
    }

    .primary-btn-icon {
      width: 17px;
      height: 17px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #f9fafb, #d1fae5 55%, #22c55e 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .primary-btn-icon svg {
      width: 11px;
      height: 11px;
      stroke: #022c22;
    }

    .secondary-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.55);
      padding: 6px 12px;
      font-size: 11px;
      color: var(--text-muted);
      background: rgba(15,23,42,0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: border-color var(--transition-fast), color var(--transition-fast), background var(--transition-fast);
    }

    .secondary-btn:hover {
      border-color: rgba(148,163,184,0.9);
      color: #e5e7eb;
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.15), rgba(15,23,42,0.9));
    }

    .secondary-btn svg {
      width: 12px;
      height: 12px;
      stroke: rgba(156,163,175,0.85);
    }

    /* Response panel */
    .status-badge {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(52,211,153,0.6);
      background: radial-gradient(circle at 0 0, rgba(34,197,94,0.35), rgba(15,23,42,0.95));
      color: #bbf7d0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #bbf7d0, #22c55e);
      box-shadow: 0 0 10px rgba(34,197,94,0.9);
    }

    .response-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
    }

    .response-meta strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .tab-row {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 8px;
    }

    .tab {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid transparent;
      color: rgba(148,163,184,0.9);
      background: transparent;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast);
    }

    .tab.active {
      color: #e5e7eb;
      border-color: rgba(129,140,248,0.9);
      background: radial-gradient(circle at 0 0, rgba(79,70,229,0.35), rgba(15,23,42,0.95));
    }

    .response-container {
      border-radius: 14px;
      border: 1px solid rgba(55,65,81,0.95);
      background: radial-gradient(circle at 0 0, rgba(15,23,42,0.9), #020617);
      padding: 10px 11px;
      position: relative;
      overflow: hidden;
    }

    .response-container::before {
      content: "";
      position: absolute;
      inset: -160px;
      background:
        radial-gradient(circle at 0 0, rgba(129,140,248,0.18), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(56,189,248,0.15), transparent 60%);
      opacity: 0.7;
      pointer-events: none;
    }

    .response-content {
      position: relative;
      z-index: 1;
    }

    .code-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 10px;
      color: var(--text-muted);
    }

    .code-toolbar-left {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .code-pill {
      padding: 1px 5px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
    }

    .code-badge {
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(17,24,39,0.95);
      border: 1px solid rgba(55,65,81,0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .code-badge svg {
      width: 10px;
      height: 10px;
      stroke: rgba(156,163,175,0.9);
    }

    .code-scroll {
      max-height: 360px;
      overflow: auto;
      border-radius: 10px;
      background: rgba(15,23,42,0.92);
      padding: 8px 10px;
      font-size: 12px;
      font-family: ui-monospace, Menlo, Monaco, Consolas, "SF Mono", monospace;
      color: #e5e7eb;
      line-height: 1.4;
      scrollbar-width: thin;
      scrollbar-color: rgba(55,65,81,0.9) transparent;
    }

    .code-scroll::-webkit-scrollbar {
      width: 7px;
      height: 7px;
    }

    .code-scroll::-webkit-scrollbar-track {
      background: transparent;
    }

    .code-scroll::-webkit-scrollbar-thumb {
      background: rgba(55,65,81,0.9);
      border-radius: 999px;
    }

    .code-scroll pre {
      margin: 0;
      white-space: pre;
    }

    .hint-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      font-size: 10px;
      color: var(--text-muted);
    }

    .hint-row span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .hint-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #a3e635);
    }

    .hint-shortcut {
      padding: 1px 5px;
      border-radius: 999px;
      border: 1px dashed rgba(75,85,99,0.9);
    }

    .error-text {
      color: var(--danger);
      font-size: 11px;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- LEFT: Request -->
    <section class="panel">
      <div class="panel-inner">
        <header class="panel-header">
          <div class="panel-title">
            <span class="panel-title-chip"></span>
            <span>API Request Console</span>
          </div>
          <div class="panel-subtitle">
            Prototype REST client pour tes endpoints
          </div>
        </header>

        <div class="badge-row">
          <div class="badge-group">
            <div class="badge badge-pill">
              <span class="badge-dot"></span>
              <span>Mode dev</span>
            </div>
            <div class="badge">
              <span>⌘⏎</span>
              <span>Exécuter la requête</span>
            </div>
          </div>
          <button class="secondary-btn" type="button" onclick="resetForm()">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M4 4v6h6M20 20v-6h-6M6 14a4 4 0 0 0 6.8 2.8L16 14M18 10a4 4 0 0 0-6.8-2.8L8 10" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Reset</span>
          </button>
        </div>

        <!-- Method + URL -->
        <div class="field-grid">
          <div class="label">Méthode</div>
          <div class="method-select">
            <button class="method-pill active" type="button" data-method="GET">GET</button>
            <button class="method-pill" type="button" data-method="POST">POST</button>
            <button class="method-pill" type="button" data-method="PUT">PUT</button>
            <button class="method-pill" type="button" data-method="DELETE">DELETE</button>
          </div>
        </div>

        <div class="field-grid">
          <div class="label">Endpoint</div>
          <input id="url-input" class="input" type="text" placeholder="https://api.example.com/v1/emails/validate" />
        </div>

        <div class="row row-space" style="margin-bottom: 8px;">
          <div class="label">Headers</div>
          <button class="secondary-btn" type="button" onclick="toggleAuthHeader()">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 12v4M12 8h.01M5 9a7 7 0 1 1 14 0v3a7 7 0 1 1-14 0V9Z" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Auth rapide</span>
          </button>
        </div>

        <div class="row row-wrap" style="margin-bottom: 10px;">
          <input id="header-key" class="input input-sm" style="max-width: 140px;" placeholder="Header key (ex: Authorization)" />
          <input id="header-value" class="input input-sm" placeholder="Header value" />
        </div>

        <div class="row row-space" style="margin-bottom: 6px;">
          <div class="label">Body JSON</div>
          <span class="meta-chip">
            <span style="width:6px;height:6px;border-radius:999px;background:var(--accent);"></span>
            <strong>Raw</strong> JSON
          </span>
        </div>

        <textarea id="body-input" class="textarea" spellcheck="false" placeholder='{"email": "amine@example.com"}'></textarea>

        <div class="divider"></div>

        <div class="row row-space">
          <div class="response-meta" style="font-size:10px;">
            <span class="meta-chip"><strong>Tips</strong> Edge cases, timeouts, erreurs 4xx/5xx</span>
          </div>
          <button class="primary-btn" type="button" onclick="sendRequest()">
            <span class="primary-btn-icon">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M5 12h7M13 5l7 7-7 7" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </span>
            <span>Send request</span>
          </button>
        </div>
      </div>
    </section>

    <!-- RIGHT: Response -->
    <section class="panel">
      <div class="panel-inner">
        <header class="panel-header">
          <div class="panel-title">
            <span class="panel-title-chip"></span>
            <span>API Response Viewer</span>
          </div>
          <div class="panel-subtitle">
            Status, headers & JSON retour
          </div>
        </header>

        <div class="badge-row" style="margin-bottom: 8px;">
          <div class="response-meta">
            <span class="status-badge" id="status-badge">
              <span class="status-dot"></span>
              <span>En attente de requête</span>
            </span>
          </div>
          <div class="badge-group">
            <div class="badge">
              <span>⌘⇧C</span>
              <span>Copier JSON</span>
            </div>
          </div>
        </div>

        <div class="response-meta" style="margin-bottom:8px;">
          <span id="response-status">Status: -</span>
          <span>•</span>
          <span id="response-time">Temps: -</span>
          <span>•</span>
          <span id="response-size">Taille: -</span>
        </div>

        <div class="tab-row">
          <button class="tab active" type="button" data-tab="json" onclick="switchTab('json')">JSON brut</button>
          <button class="tab" type="button" data-tab="headers" onclick="switchTab('headers')">Headers</button>
          <button class="tab" type="button" data-tab="meta" onclick="switchTab('meta')">Meta</button>
        </div>

        <div class="response-container">
          <div class="response-content">
            <div class="code-toolbar">
              <div class="code-toolbar-left">
                <div class="code-pill" id="tab-label">JSON</div>
                <div class="code-badge">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M5 7h14M5 12h8M5 17h4" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span id="code-mode">Raw view</span>
                </div>
              </div>
              <button class="secondary-btn" type="button" onclick="copyCurrent()">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M9 9h9a1 1 0 0 1 1 1v9M7 15H6a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v1" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span>Copier</span>
              </button>
            </div>

            <div id="json-view" class="code-scroll">
              <pre id="json-output">Aucune requête envoyée pour le moment.</pre>
            </div>
            <div id="headers-view" class="code-scroll" style="display:none;">
              <pre id="headers-output">Headers non disponibles.</pre>
            </div>
            <div id="meta-view" class="code-scroll" style="display:none;">
              <pre id="meta-output">Meta non disponible.</pre>
            </div>
          </div>
        </div>

        <div class="hint-row">
          <span>
            <span class="hint-dot"></span>
            <span>JSON laissé volontairement brut (aucune transformation du payload).</span>
          </span>
          <span class="hint-shortcut">Esc pour nettoyer</span>
        </div>

        <div style="margin-top:6px;font-size:10px;color:var(--text-muted);">
          <span id="error-message" class="error-text"></span>
        </div>
      </div>
    </section>
  </div>

  <script>
    let currentMethod = "GET";
    let lastResponseBody = "";
    let lastResponseHeaders = "";
    let lastMeta = "";

    // Méthodes (pills)
    document.querySelectorAll(".method-pill").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".method-pill").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentMethod = btn.getAttribute("data-method");
      });
    });

    function resetForm() {
      document.getElementById("url-input").value = "";
      document.getElementById("header-key").value = "";
      document.getElementById("header-value").value = "";
      document.getElementById("body-input").value = "";
      document.getElementById("json-output").textContent = "Aucune requête envoyée pour le moment.";
      document.getElementById("headers-output").textContent = "Headers non disponibles.";
      document.getElementById("meta-output").textContent = "Meta non disponible.";
      document.getElementById("status-badge").innerHTML = '<span class="status-dot"></span><span>En attente de requête</span>';
      document.getElementById("response-status").textContent = "Status: -";
      document.getElementById("response-time").textContent = "Temps: -";
      document.getElementById("response-size").textContent = "Taille: -";
      document.getElementById("error-message").textContent = "";
    }

    function toggleAuthHeader() {
      const keyInput = document.getElementById("header-key");
      const valueInput = document.getElementById("header-value");
      if (keyInput.value.toLowerCase() === "authorization") {
        keyInput.value = "";
        valueInput.value = "";
      } else {
        keyInput.value = "Authorization";
        valueInput.placeholder = "Bearer xxxxx";
        valueInput.focus();
      }
    }

    function switchTab(tab) {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      document.querySelector('.tab[data-tab="' + tab + '"]').classList.add("active");

      document.getElementById("json-view").style.display = tab === "json" ? "block" : "none";
      document.getElementById("headers-view").style.display = tab === "headers" ? "block" : "none";
      document.getElementById("meta-view").style.display = tab === "meta" ? "block" : "none";

      const tabLabel = document.getElementById("tab-label");
      const codeMode = document.getElementById("code-mode");

      if (tab === "json") {
        tabLabel.textContent = "JSON";
        codeMode.textContent = "Raw view";
      } else if (tab === "headers") {
        tabLabel.textContent = "Headers";
        codeMode.textContent = "Key/Value";
      } else {
        tabLabel.textContent = "Meta";
        codeMode.textContent = "Debug info";
      }
    }

    async function sendRequest() {
      const url = document.getElementById("url-input").value.trim();
      const headerKey = document.getElementById("header-key").value.trim();
      const headerValue = document.getElementById("header-value").value.trim();
      const bodyRaw = document.getElementById("body-input").value.trim();
      const errorMessage = document.getElementById("error-message");

      errorMessage.textContent = "";

      if (!url) {
        errorMessage.textContent = "URL manquante.";
        return;
      }

      let headers = {};
      if (headerKey && headerValue) {
        headers[headerKey] = headerValue;
      }
      if (currentMethod !== "GET" && bodyRaw) {
        headers["Content-Type"] = "application/json";
      }

      let payload;
      if (currentMethod !== "GET" && bodyRaw) {
        try {
          // On parse uniquement pour vérifier que le JSON n'est pas cassé
          JSON.parse(bodyRaw);
          payload = bodyRaw;
        } catch (e) {
          errorMessage.textContent = "JSON invalide dans le body.";
          return;
        }
      }

      const start = performance.now();
      document.getElementById("status-badge").innerHTML =
        '<span class="status-dot"></span><span>Requête en cours...</span>';
      document.getElementById("json-output").textContent = "…";
      document.getElementById("headers-output").textContent = "…";
      document.getElementById("meta-output").textContent = "…";

      try {
        const response = await fetch(url, {
          method: currentMethod,
          headers,
          body: currentMethod === "GET" ? undefined : payload
        });

        const end = performance.now();
        const time = Math.round(end - start);

        const clone = response.clone();
        let bodyText;
        try {
          bodyText = await clone.text();
        } catch {
          bodyText = "<no body>";
        }

        const size = bodyText ? new Blob([bodyText]).size : 0;

        lastResponseBody = bodyText || "";
        lastResponseHeaders = "";
        response.headers.forEach((value, key) => {
          lastResponseHeaders += key + ": " + value + "\n";
        });

        lastMeta =
          "URL: " + url + "\n" +
          "Method: " + currentMethod + "\n" +
          "Status: " + response.status + " " + (response.statusText || "") + "\n" +
          "Time: " + time + " ms\n" +
          "Size: " + size + " bytes\n";

        // Status badge
        const badge = document.getElementById("status-badge");
        if (response.ok) {
          badge.innerHTML = '<span class="status-dot"></span><span>Succès (' + response.status + ')</span>';
        } else {
          badge.innerHTML =
            '<span class="status-dot" style="background:radial-gradient(circle at 30% 0,#fecaca,#ef4444);box-shadow:0 0 10px rgba(239,68,68,0.9);"></span>' +
            '<span>Erreur (' + response.status + ')</span>';
        }

        document.getElementById("response-status").textContent =
          "Status: " + response.status + " " + (response.statusText || "");
        document.getElementById("response-time").textContent = "Temps: " + time + " ms";
        document.getElementById("response-size").textContent = "Taille: " + size + " bytes";

        document.getElementById("json-output").textContent = bodyText || "<empty>";
        document.getElementById("headers-output").textContent =
          lastResponseHeaders || "Aucun header renvoyé.";
        document.getElementById("meta-output").textContent = lastMeta;
      } catch (err) {
        document.getElementById("status-badge").innerHTML =
          '<span class="status-dot" style="background:radial-gradient(circle at 30% 0,#fecaca,#ef4444);box-shadow:0 0 10px rgba(239,68,68,0.9);"></span>' +
          '<span>Erreur réseau</span>';
        document.getElementById("json-output").textContent = String(err);
        document.getElementById("headers-output").textContent = "Headers non disponibles.";
        document.getElementById("meta-output").textContent = "Requête échouée.";
        errorMessage.textContent = "Impossible d'appeler l'API (" + err.message + ").";
      }
    }

    function copyCurrent() {
      const activeTab = document.querySelector(".tab.active").getAttribute("data-tab");
      let text = "";
      if (activeTab === "json") {
        text = document.getElementById("json-output").textContent || "";
      } else if (activeTab === "headers") {
        text = document.getElementById("headers-output").textContent || "";
      } else {
        text = document.getElementById("meta-output").textContent || "";
      }
      if (!text) return;

      navigator.clipboard.writeText(text).catch(() => {});
    }

    // Raccourcis clavier
    window.addEventListener("keydown", (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
        e.preventDefault();
        sendRequest();
      }
      if (e.key === "Escape") {
        resetForm();
      }
    });
  </script>
</body>
</html>
